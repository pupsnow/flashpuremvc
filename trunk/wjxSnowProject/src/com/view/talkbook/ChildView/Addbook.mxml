<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" width="500"
	 height="500" verticalGap="0" title="留言" layout="vertical" 
	 xmlns:view="com.view.*" xmlns:basecomponent="basecom.basecomponent.*" xmlns:containers="basecom.basecomponent.containers.*">
	 <mx:Script>
	 	<![CDATA[
	 		import mx.controls.Alert;
	 		import basecom.business.Service;
	 		import mx.formatters.DateFormatter;
	 		import mx.events.ValidationResultEvent;
	 		import com.model.ContentModel;
	 		import mx.core.Application;
	 		import mx.managers.PopUpManager;
	 		[Bindable]
	 		public var model:ContentModel;
	 		[Bindable]
	 		public var addbook:Service;
	 
	 	
	 	private function showdata():void
			{
				var date:Date=new Date();
				var timeformat:DateFormatter=new DateFormatter();
				timeformat.formatString="YYYY-MM-DD JJ:NN:SS";
			if(nameval.validate().type==ValidationResultEvent.VALID&&
			   emailval.validate().type==ValidationResultEvent.VALID)
			   {
			   	
				model.username=username.text;
				model.content=content.text;
				model.sex=sex.selectedValue.toString();
				model.email=email.text;
				model.time=timeformat.format(date);
				trace(timeformat.format(date).toString());
				model.isadminsee=isadminsee.selected?"1":"0";
				close();
				addbook.addbook.send();
			   }
			else
			{
				Alert.show("姓名或邮箱没填写正确","提示");
			}
			}
		private function clear():void
		{
			username.text="";
			email.text="";
			content.text="";
			
		}
		private function close():void
		{
		  PopUpManager.removePopUp(this);
		}
		private function changeshow():void
		{
			var show:QQShow=new QQShow();
			    show.model=model;
			    show.show_fun=showimage;
			PopUpManager.addPopUp(show,this,true);
			PopUpManager.centerPopUp(show);
		}
		private function showimage():void
		{
			bot.source=QQShow.BOTTOMURL+model.qqshowData[3]+'.gif';
			mid.source=QQShow.MIDDILEURL+model.qqshowData[2]+'.gif';
			top.source=QQShow.TOPURL+model.qqshowData[1]+'.gif';
			head.source=QQShow.HEADURL+model.qqshowData[0]+'.gif';
		}
	 	]]>
	 </mx:Script>
	 <mx:Metadata>
	 	[Event(name="addclick")]
	 </mx:Metadata>
	 <mx:EmailValidator source="{email}" id="emailval" property="text" 
	 	required="true" requiredFieldError="此项必须填写"  trigger="{submit}"/>
     <mx:StringValidator source="{username}" id="nameval" property="text" 
     	required="true" requiredFieldError="此项必须填写"   trigger="{submit}"/>
	<containers:MyHBox width="100%">
		<mx:Canvas width="150" height="230" borderColor="#1B3EC2" 
			borderThickness="2" borderStyle="outset" cornerRadius="5">
			    <mx:Image id="bot" source="images/qqshow/bottom/df.gif"/>
			    <mx:Image id="mid" source="images/qqshow/middile/df.gif"/>
			    <mx:Image id="top" source="images/qqshow/top/df.gif"/>
				<mx:Image id="head" source="images/qqshow/head/df.gif"/>
		</mx:Canvas>
		<containers:MyVBox width="100%" height="100%"  horizontalGap="3">
		    <mx:FormItem  label="姓名:" required="true">
			<mx:TextInput id="username" maxChars="50"/>
			</mx:FormItem>
			<mx:HRule width="100%"/>	
			<mx:FormItem  label="性别:" direction="horizontal"> 	
		 	<mx:RadioButtonGroup id="sex"/>
		 	<mx:RadioButton groupName="sex" id="man" label="男" value="男" selected="true"/>
		    <mx:RadioButton groupName="sex" id="woman" label="女" value="女"/>
			</mx:FormItem>		
			<mx:HRule width="100%"/>
			<mx:FormItem  label="邮箱:" required="true">
			<mx:TextInput id="email" maxChars="50"/>
			</mx:FormItem>
			<mx:Button label="更换形象" click="changeshow()"/>
	   </containers:MyVBox>
	</containers:MyHBox>			
	<mx:TextArea width="100%" height="100%" id="content" maxChars="255"/>
	<mx:ApplicationControlBar width="100%" horizontalAlign="center">
		<mx:CheckBox  id="isadminsee" label="此消息限管理员看" color="0x000000"/>
		<mx:Spacer width="100%"/>
		<mx:LinkButton label="提交" click="showdata();" id="submit"/>
		<mx:LinkButton label="重写" click="clear()"/>
		<mx:LinkButton label="退出" click="close()"/>
	</mx:ApplicationControlBar>
</mx:TitleWindow>
